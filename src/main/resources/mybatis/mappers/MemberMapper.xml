<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.oneteam.dormeaseadmin.admin.member.IMemberMapper">

    <select id="selectDuplicateByID" parameterType="String" resultType="boolean">
        SELECT
            count(*)
        FROM
            (SELECT
                 id
             FROM
                 student
             UNION
             SELECT
                 id
             FROM
                 parents
             UNION
             SELECT
                 id
             FROM
                 admin) u
        WHERE
            id = #{id}
    </select>

    <insert id="createAccountConfirm" parameterType="MemberDto">
        INSERT INTO
            admin (
                school_no,
                id,
                password,
                name,
                gender,
                position,
                phone,
                zip_code,
                address,
                address_detail1,
                address_detail2,
                mail,
                reg_date,
                mod_date
            )
        VALUES (
            #{school_no},
            #{id},
            #{password},
            #{name},
            #{gender},
            #{position},
            #{phone},
            #{zip_code},
            #{address},
            #{address_detail1},
            #{address_detail2},
            #{mail},
            NOW(),
            NOW()
        )
    </insert>
    <select id="selectMemberByID" parameterType="String" resultType="MemberDto">
        SELECT
            *
        FROM
            admin
        WHERE
            id = #{id}
    </select>
    <insert id="insertAdminLoginHistory" parameterType="MemberDto">
        INSERT INTO
            admin_login_history
        (
            admin_id, admin_name, admin_grade, admin_mail, login_ip, login_date
        )
        VALUES
            (
             #{id}, #{name}, #{grade}, #{mail}, '218.235.89.82', NOW()
            )
    </insert>
    <select id="selectMaxNoFromLoginHistory">
        SELECT
            max(no)
        FROM
            admin_login_history
        WHERE
            admin_id = #{id}
    </select>
    <update id="updateFailCount">
        UPDATE
            admin
        SET
            <if test="no != 0">
            fail_count = 0
            </if>
            <if test="no == 0">
            fail_count = fail_count + 1
            </if>
        WHERE
            id = #{id}
    </update>
    <update id="updateAdminLoginHistory">
        UPDATE
            admin_login_history
        SET
            logout_date = NOW()
        WHERE
            no = #{maxNo}
    </update>
</mapper>